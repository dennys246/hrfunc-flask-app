{% extends "base.html" %}
{% block title %}HRF Upload | HRfunc{% endblock %}
{% block content %}

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="alert alert-success">
      {{ messages[0] }}
    </div>
  {% endif %}
{% endwith %}
s
  <form action="{{ url_for('upload_json') }}" method="POST" enctype="multipart/form-data" class="max-w-xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md">
    <div class="w-full bg-indigo-200 text-indigo-800 font-medium py-2 px-4 rounded-md">
    The HRF submissions system has been successfully transfered to a new server. 
    Expect a confirmation email shortly after your HRF uploads complete from do-not-reply@hrfunc.org.</div><br>
    <h2 class="text-xl font-semibold mb-4 text-center text-indigo-800 dark:text-indigo-400">Collaborate with your HRF estimates</h2>
    <p class="mb-4 text-center text-gray-800 dark:text-gray-100">
    Share the HRF's you estimate using <strong>HR<i><span style="font-family: 'Times New Roman', serif;">func</span></i></strong>
     with the wider fNIRS community by uploading it here. You must
    have a published paper with a DOI included in your submission for your HRF to be accepted.
    You'll recieve an email confirming we've recieved you're HRFs soon after.<br><br>
    Please add as accurate experimental contexts related to your paradigm to allow for other 
    researchers to search for your experimental paradigm.
    Submissions of HRFs from meaningful subsets of your subject
     pool (i.e. only women or men, 5 YO, etc.) are welcomed and encouraged!
    </p>
      <br><br>
        <div class="w-full">
        <div style="padding:56.25% 0 0 0;position:relative;">
            <iframe 
            src="https://player.vimeo.com/video/1112127116?badge=0&autopause=0&player_id=0&app_id=58479" 
            frameborder="0" 
            allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media" 
            style="position:absolute;top:0;left:0;width:100%;height:100%;" 
            title="snowgan_snowpack_intro_denny_schaedig">
            </iframe>
        </div>
        <script src="https://player.vimeo.com/api/player.js"></script>
        
        <p class="mt-2 text-center text-indigo-200 dark:text-indigo-200 italic">
            Video guide of how to submit HRFs to be added to the HRtree...
        </p>
      </div><br><br>
    <div class="mb-4">
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Your Name</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Enter your name
        </p>
        <input type="text" name="name" id="name" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">

      </div>
      <br>
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Enter an email address to contact you at in case updates need to be made of your HRF entry to the HRtree
        </p>
        <input type="text" name="email" id="email" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Phone Number</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Enter a phone number to contact you at in case updates need to be made of your HRF entry to the HRtree
        </p>
        <input type="text" name="phone" id="phone" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
        </div>
      <br>
      <div>
        <label for="study" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Study Name</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Enter the official study name as listed in your project records.
        </p>
        <input type="text" name="study" id="study" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="area-codes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Area Codes</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the primary telephone area codes where this dataset was collected from seperated by commas.
        </p>
        <input type="text" name="area-codes" id="area-codes" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="doi" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">DOI of Paper Detailing Data Collection</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Enter the DOI of the paper describing how you're dataset was collected
        </p>
        <input type="text" name="doi" id="doi" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
      <label for="dataset_ownership" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
          Do you own the dataset HRFs were estimated from?
        </label>
        <select name="dataset_ownership" id="dataset_ownership" required
                class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
          <option value="">Select...</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>

      <div id = "dataset_permission_section">
        <br>
        <label for="dataset_permission" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
        Do you have explicit permission from the datasets owner to add HRFs estimated from their data to the 
        <strong>HR<i><span style="font-family: 'Times New Roman', serif;">tree</span></i></strong>?
        </label>
        <select name="dataset_permission" id="dataset_permission" required
                class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
          <option value="">Select...</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>

      <!-- Permission Issue -->

      <div id = "permission_issue">
        <span class = "block w-full bg-yellow-200 text-yellow-900 text-sm font-medium py-2 px-4 rounded-md">
          ⚠️ Without explicit permission from the dataset owner we cannot add the HRFs you
          estimated from HRfunc to the HRtree. Please reach out to the dataset owner and
          obtain permission to proceed with uploading HRFs to the HRtree.
        </span>
      </div>

      <!-- Follow-up question 1 -->
      <div id = "owner_followup_1">
        <br>
        <label for="dataset_owner" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Dataset Owner Name</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the name of the dataset owner
        </p>
        <input type="text" name="dataset_owner" id="dataset_owner" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>

      <!-- Follow-up question 2 -->
      <div id = "owner_followup_2">
        <br>
        <label for="dataset_contact" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Dataset Owner Email</label>
        <p id="study-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter an email to contact the dataset owner for us to confirm HRF upload
        </p>
        <input type="text" name="dataset_contact" id="dataset_contact" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">

      </div>

      <script>
        const datasetOwnershipSelect = document.getElementById('dataset_ownership');
        const datasetPermissionSection = document.getElementById('dataset_permission_section');
        const datasetPermissionSelect = document.getElementById('dataset_permission');
        const permissionIssueBanner = document.getElementById('permission_issue');
        const ownerFollowup1 = document.getElementById('owner_followup_1');
        const ownerFollowup2 = document.getElementById('owner_followup_2');
        const datasetOwnerInput = document.getElementById('dataset_owner');
        const datasetContactInput = document.getElementById('dataset_contact');

        function updatePermissionFlow() {
          if (datasetPermissionSelect.value === 'no') {
            permissionIssueBanner.classList.remove('hidden');
            ownerFollowup1.classList.add('hidden');
            ownerFollowup2.classList.add('hidden');
            datasetOwnerInput.required = false;
            datasetContactInput.required = false;
            datasetOwnerInput.value = '';
            datasetContactInput.value = '';
          } else if (datasetPermissionSelect.value === 'yes') {
            permissionIssueBanner.classList.add('hidden');
            ownerFollowup1.classList.remove('hidden');
            ownerFollowup2.classList.remove('hidden');
            datasetOwnerInput.required = true;
            datasetContactInput.required = true;
          } else {
            permissionIssueBanner.classList.add('hidden');
            ownerFollowup1.classList.add('hidden');
            ownerFollowup2.classList.add('hidden');
            datasetOwnerInput.required = false;
            datasetContactInput.required = false;
            datasetOwnerInput.value = '';
            datasetContactInput.value = '';
          }
        }

        function updateOwnershipFlow() {
          if (datasetOwnershipSelect.value === 'no') {
            datasetPermissionSection.classList.remove('hidden');
            datasetPermissionSelect.required = true;
          } else {
            datasetPermissionSection.classList.add('hidden');
            datasetPermissionSelect.required = false;
            datasetPermissionSelect.value = '';
          }
          updatePermissionFlow();
        }

        datasetOwnershipSelect.addEventListener('change', updateOwnershipFlow);
        datasetPermissionSelect.addEventListener('change', updatePermissionFlow);
        updateOwnershipFlow();
      </script>
      <br>
      <div>
        <label for="hrfunc_standard" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
          Did you estimate these HRFs using the standard unaltered 
          <strong>HR<i><span style="font-family: 'Times New Roman', serif;">func</span></i></strong> library?
        </label>
        <select name="hrfunc_standard" id="hrfunc_standard" required
                class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
          <option value="">Select...</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>

      <div id = "hrfunc_extension_comment" class="mt-3">
        <label for="hrfunc_extension_label" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
          How did you alter the HRfunc library to estimate your HRFs?
        </label>
        <p id="extension-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Extensions and modifications to the HRfunc library are more than welcomed, 
          however <b class = "text-gray-200">the DOI you listed above must detail how you deviated</b> from
          the standard HRfunc library. This is intended to ensure all HRFs in the 
          HRtree can be traced back to their origin and replicated. Please summarize the changes to the HRfunc library
          you made for HRtree explorer's to understand the origins of your HRFs.
        </p><br>
        <textarea name="hrfunc_extension" id="hrfunc_extension" rows="3" placeholder="Enter additional details if necessary..."
                  class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
        <p id="extension-warning" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          HRFs estimated outside of the HRfunc library are difficult
          to incorperate directly into the HRtree but are incredibly valuable none-the-less.
          If you did estimate HRFs outside of the HRfunc library please reach out to help@hrfunc.org
          to see if we can integrate your HRFs directly into the HRtree.
        </p>
        </div>

      <script>
        const hrfuncStandardSelect = document.getElementById('hrfunc_standard');
        const hrfuncExtensionComments = document.getElementById('hrfunc_extension_comment');

        hrfuncExtensionComments.classList.add('hidden');

        hrfuncStandardSelect.addEventListener('change', () => {
          if (hrfuncStandardSelect.value === 'no') {
            hrfuncExtensionComments.classList.remove('hidden');
          } else {
            hrfuncExtensionComments.classList.add('hidden');
          }
        });
      </script>

      <br>
      <div>
        <label for="dataset_subset" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
          Are the HRF you're submitting estimated from a subset of your dataset?
        </label>
        <select name="dataset_subset" id="dataset_subset" required
                class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
          <option value="">Select...</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>
      <br>
      <div class="relative my-8 justify-center text-center">
        <span class="bg-white dark:bg-gray-800 px-3 text-lg text-gray-300 dark:text-gray-300">
          <strong>HRF Context</strong>
        </span>
        <div class="relative inset-0 flex items-center" aria-hidden="true">
          <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
        </div>
        <div class="relative flex justify-center">
        </div>
        <div class="w-full text-sm text-gray-300 dark:">
          Please seperate each experimental context with a comma (i.e. "directional,congruent"). Explore previously <a href="/experimental_contexts" class="font-semibold text-indigo-400 hover:text-indigo-700">defined contexts here</a>
        </div>
      </div>
      <div>
        <label for="task" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Task</label>
        <p id="task-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the task name (i.e. flanker, stroop, n-back)
        </p>
        <input type="text" name="task" id="task" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="conditions" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Conditions</label>
        <p id="conditions-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the task conditions estimated from (i.e. congruent, incongruent, etc.)
        </p>
        <input type="text" name="conditions" id="conditions" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="stimuli" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Stimulus</label>
        <p id="stimuli-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the stimuli from your task (i.e. arrows, colors, faces, etc.)
        </p>
        <input type="text" name="stimuli" id="stimuli" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="medium" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Stimulus Medium</label>
        <p id="medium-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the stimuli medium for your task (i.e. monitor, cards, puzzle, etc.)
        </p>
        <input type="text" name="medium" id="medium" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="intensity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Stimuli intensity</label>
        <p id="intensity-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the relative stimuli intensity of your task. If your experiment does not modulate stimuli intensity 
          throughout the task or you estimated HRFs across all stimuli intensities, set to 1.0.
        </p>
        <input type="text" name = "intensity" id = "intensity" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="protocol" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Protocol</label>
        <p id="protocol-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter your task protocol, often times this is your particular version of a
          task such as the specialized Gooble protocol for the Flanker task using 
          Aliens facing different directions instead of the standard arrows for the Flanker task. If
          no specialized protocol was used, set to 'default'.
        </p>
        <input type="text" name="protocol" id="protocol" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="age" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Age Range</label>
        <p id="age-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the age range subject HRFs were estimated from using format (-1, 0). 
          In this example we estimated HRFs from pre-term infants.
        </p>
        <input type="text" name="age" id="age" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div>
        <label for="demographics" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Demographics</label>
        <p id="medium-description" class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Please enter the finest-granularity demographics of subjects you estimated HRFs from.
          If you estimated HRFs from a whole subject pool representing ideally a populations 
          demographics please enter 'all'.
        </p>
        <input type="text" name="demographics" id="demographics" required
               class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      </div>
      <br>
      <div class="relative my-8">
        <div class="absolute inset-0 flex items-center" aria-hidden="true">
          <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
        </div>
        <div class="relative flex justify-center">
          <span class="bg-white dark:bg-gray-800 px-3 text-sm text-gray-500 dark:text-gray-400">
            Upload your HRF estimates
          </span>
        </div>
      </div>
      <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" for="jsonFile">
          Select your HRF.json file:
        </label>
      </div>
      <input type="file" name="jsonFile" id="jsonFile" accept=".json"
             class="block w-full text-sm items-center text-gray-800 dark:text-gray-100 file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0 file:text-sm file:font-semibold
                    file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100
                    dark:file:bg-indigo-900 dark:file:text-indigo-300 dark:hover:file:bg-indigo-800"
             required>
    </div>
    <div class="mt-3">
      <label for="comment" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
        Additional Comments
      </label>
      <textarea name="comment" id="comment" rows="3" placeholder="Enter additional details if necessary..."
                class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
    </div>
    <br>
      <div class="flex justify-center mt-6">
      <button type="submit"
              class="text-white px-4 py-2 rounded-md hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600">
        Upload
      </button>
    </div>
  </form>


{% endblock %}
